---
layout: viz
title: Data
category: 'data'
---
<script src="{{ site.baseurl}}/lib/javascripts/director.min.js"></script>
<script src="{{ site.baseurl}}/lib/javascripts/json-to-table.js"></script>
<ul id="myTab" class="nav nav-tabs">
  <li class="active"><a href="#proj">Projects</a></li>
  <li><a href="#data">Data</a></li>
  <li><a href="#issues" id="issues-tab">Issues</a></li>
</ul>
<div class="tab-content">
	<div id="proj" class="tab-pane active">
		<div id="project" class="col-md-8 col-sm-7 col-xs-12 pull-right" style="display:none; z-index:1000;">
			<h3><span class="arcid"></span><span style="float:right; font-size:small"><button class="btn btn-default" id="edit" role="button">Edit</button></span></h3>
			<ul id="project-pill" class="nav nav-pills">
				<li id="home-tab" class="active"><a href="#home">Home</a></li>
				
				<li><a href="#details">Details</a></li>
				<li><a href="#history" id="history-tab">History</a></li>
			</ul>
			<div class="tab-content">
				<div id="history" class="tab-pane pill">
					
						<h1>History</h1>
					
				</div>
				<div id="details" class="tab-pane pill">
					
						<h1>Details</h1>
						<div id="proj-map"><img width="300px" height="225px" src="http://ojw.dev.openstreetmap.org/StaticMap/?lat=33.793117596502&lon=-84.399032592773&z=14&mode=Location&mlat0=33.795400116601&mlon0=-84.394226074219&show=1" ismap=""></div>
					
				</div>
				<div id="home" class="tab-pane pill active">
					<p><span class="description"></span></p>
					<p>
						<strong>Sponsor:</strong> <span class="sponsor"></span>&nbsp;&nbsp;&nbsp;
						<strong>Jurisdiction:</strong> <span class="jurisdiction"></span>&nbsp;&nbsp;&nbsp;
						<strong>Status:</strong> <span class="status"></span>
					</p>
					<p>
						<strong>Analysis Level:</strong> <span class="analysis"></span>&nbsp;&nbsp;&nbsp;
					</p>
					<p><strong>FiscalYear:</strong> 
					<span><select class="fiscal-year" >
						  <option>2013</option>
						  <option>2014</option>
						  <option>2015</option>
						  <option>2016</option>
						  <option>2017</option>
						</select>
					</span>
					</p>
					<div style="overflow:auto; max-height:300px">
						<table id="js-table" class="table table-condensed table-bordered"></table>
					</div>
					
					<hr>
					<h4>Open an issue for <span class="arcid"></span>:</h4>
					<input id="issue-title" type="text" class="form-control" placeholder=""></br>
					<textarea id="issue-body" class="form-control" rows="3" placeholder="Describe issue or change here..."></textarea></br>
					<label>Issue Type:</label></br>
					<button id="general" class="issue btn btn-sm btn-primary" role="button">General</button>
					<button id="delay" class="issue btn btn-sm btn-warning" role="button">Delay</button>
					<button id="delete" class="issue btn btn-sm btn-danger" role="button">Delete</button>
					<button id="funding" class="issue btn btn-sm btn-success" role="button">Funding</button><hr>
				</div>
			</div>
		</div>
		<div class="col-md-4 col-sm-5">
			<h1>Individual Projects</h1>
			<p>Here you'll find all of the data segmented by individual projects:</p>
			<div class="table-responsive" style="height:300px; overflow:auto;">
				<table id="projects"  class="table table-hover table-condensed"></table>
			</div>
		</div>
   </div>
   <div id="issues" class="tab-pane">
   	 <div class="col-md-6">
     <h1>Issues</h1>
     <div id="issue-list"></div>
     </div>
   </div>
   <div id="data" class="tab-pane">
		<div class="col-md-6">
			<h1>Data</h1>

			<p>You can find all of the raw data related to transportation projects here:</p>
			<ul>
			<li><a href="https://github.com/landonreed/plan-it/tree/gh-pages/data/TIP">TIP</a></li>
			<li><a href="https://github.com/landonreed/plan-it/tree/gh-pages/data/LR">Long-range plan</a></li>
			</ul>
			
			<!-- <div id="tags">
				<h3>Tags</h3>
			</div> -->
		</div>
	</div>
</div>



<script type="text/javascript">
	$(document).ready(function(){
		var url = window.location.href
		var hash = url.split('/')[5]
		console.log(hash)
		$('#' + hash + '-row').addClass('active')
	})
	// $(document).live()
	$('#myTab a').click(function (e) {
		e.preventDefault()
		$(this).tab('show')
	})
	$('#project-pill a').click(function (e) {
		e.preventDefault()
		$(this).tab('show')
	})
	$('#issues-tab').click(function () {
		console.log("issues tab")
		$.get("https://api.github.com/repos/landonreed/plan-it/issues?", function (issues) {
			console.log(issues)
			$.each(issues, function(i, issue){
				$("#issue-list").append('<p><a href="'+issue.user.url+'" title="'+issue.user.login+'"><img src="'+issue.user.avatar_url+'" height="30" width="30"></a> <a href="' + issue.url + '">' + issue.title + '' + '</a></p><p>'+issue.body+'</p>');
			})
		});
	})
	var previous;
	var id;
	var record;
	var historyClick = false
    $("select").focus(function () {
        // Store the current value on focus and on change
        previous = this.value;
    })
	var router = new Router().init();
	$('.fiscal-year').change(function(){
		var value = $('.fiscal-year').val()
		if (value != previous){
			$('#issue-title').attr('placeholder', id + ': change fiscal year from ' + previous + ' to ' + value)
			$('.issue').attr("disabled", true)
			$('#delay').attr('disabled', false)
		}
		else{
			$('#issue-title').attr('placeholder', id)
			$('.issue').attr("disabled", false)
		}

	})
	$('.issue').click(function(){
		var title = ($('#issue-title').val()) ? $('#issue-title').val() : $('#issue-title').attr('placeholder')
		var body = ($('#issue-body').val()) ? $('#issue-body').val() : ''
		window.location='https://github.com/landonreed/plan-it/issues/new?title='+title+'&body='+body+'&labels='+this.id
	})
	$('#history-tab').click(function(){
		var branches = ['2008Q2',
					'2009Q2',
					'2009Q4',
					'2011Q2',
					'gh-pages']
		var rows = []
		console.log('View HIstory!')
		console.log("history tab")
		if (!historyClick){
			$("#history").empty()
			$.each(branches, function(i, branch){
				$.get('https://api.github.com/repos/landonreed/plan-it/contents/data/TIP/individual/'+id+'.csv?ref='+branch, function (file) {
					console.log(file.content)
					$("#history").append('<p>'+branch+'<a href="' + file._links.html + '">' + file.name + '' + '</a></p><table class="table">'+populateTable(d3.csv.parse(Base64.decode(file.content), function(rows){
						delete rows.ARCID
				        delete rows.Description
				        delete rows.Jurisdiction
				        delete rows.ModelingNetworkYear
				        delete rows.Sponsor
				        delete rows.ExistLanes
				        delete rows.ProposedLanes
				        delete rows.Length
				        delete rows.GDOTPI
				        delete rows.Limits
				        delete rows.Status
				        delete rows.ProjectType
				        delete rows.Analysis
				        delete rows.FundSource
				        delete rows.FederalSum
				        delete rows.StateSum
				        delete rows.LocalSum
				        delete rows.BondSum
				        delete rows.TotalSum
				        return rows;
					})
						// .row(function(d){
						// 	return {
						// 		Phase: d.Phase,
						//         Status: d.PhaseStatus,
						//         FY: d.FiscalYear,
						//         // FundSource: d.FundSource,
						//         Federal: d.Federal,
						//         State: d.State,
						//         Local: d.Local,
						//         Bond: d.Bond,
						//         Total: d.Total
						//     }
						// })
					)+'</table>');
				});
			})
		historyClick = true;
		}
		
	})
	$('.view').live('click', function(){
		var color = 'active'
		$(this).closest('tr').addClass(color).siblings().removeClass(color);
	})
	$('#edit').click(function(){
		window.location='https://github.com/landonreed/plan-it/edit/gh-pages/data/TIP/individual/'+ $('.arcid').html() +'.csv'
	})
	href="https://github.com/landonreed/plan-it/edit/gh-pages/data/TIP/individual/'+el.ARCID+'.csv"
	var uniqueIds = [];
	var jsonHtmlTable;
	function populateTable(records) {
		// console.log(records)
		var string = ''
		
		string += '<thead><tr>'
		for (var key in record[0]) {
				string += '<th>' + key
    			string += '</th>'
		}
		string += '</tr></thead>'
		
		$.each(records, function(i, record){
			string += '<tbody><tr>'
			for (var key in record) {
					string += '<td>' + record[key]
					console.log("Key: " + key);
	    			console.log("Value: " + record[key]);
	    			string += '</td>'
			}
			string += '</tr></tbody>'
		})
		return string
	}
	function doDataThings(error, rows){
		data = rows

		console.log(data);
		$.each(data, function(i, el){
	    router.on('/'+el.ARCID, function () {
	    	d3.csv("{{ site.baseurl}}/data/TIP/individual/"+el.ARCID+".csv")
	    	.row(function(d) {
		    return {
		        // ARCID: d.ARCID,
		        // Description: d.Description,
		        // Jurisdiction: d.Jurisdiction,
		        // ModelingNetworkYear: d.ModelingNetworkYear,
		        // Sponsor: d.Sponsor,
		        // ExistLanes: d.ExistLanes,
		        // ProposedLanes: d.ProposedLanes,
		        // Length: d.Length,
		        // GDOTPI: d.GDOTPI,
		        // Limits: d.Limits,
		        // Status: d.Status,
		        // ProjectType: d.ProjectType,
		        // Analysis: d.Analysis,
		        Phase: d.Phase,
		        Status: d.PhaseStatus,
		        FY: d.FiscalYear,
		        // FundSource: d.FundSource,
		        Federal: d.Federal,
		        State: d.State,
		        Local: d.Local,
		        Bond: d.Bond,
		        Total: d.Total
		        // FederalSum: d.FederalSum,
		        // StateSum: d.StateSum,
		        // LocalSum: d.LocalSum,
		        // BondSum: d.BondSum,
		        // TotalSum: d.TotalSum
		      };
		})
	    	.get(function(error, rows){
	    		record = rows;
				console.log(rows)
				$('#project')
		    		.fadeOut(250, function(){
		    			// $('#home').tab('show');
		    			$('.nav-pills li').removeClass('active'); // remove active class from tabs
		    			$('.tab-pane.pill').removeClass('active');
    					$('#home').addClass('active'); // add active class to clicked tab
    					$('#home-tab').addClass('active'); // add active class to clicked tab
    					historyClick = false;
		    			$('#issue-title').attr('placeholder', el.ARCID)
	    				$('.arcid').empty().append(el.ARCID)
	    				$('.sponsor').empty().append(el.Sponsor)
	    				$('.jurisdiction').empty().append(el.Jurisdiction)
	    				$('.status').empty().append(el.Status)
	    				$('.analysis').empty().append(el.Analysis)
	    				$('.description').empty().append(el.Description)
	    				$('.fiscal-year').val(el.FiscalYear)
	    				$('#js-table').empty().append(populateTable(record))
	    				$('#project').fadeIn(250)

	    				id = el.ARCID
    			})
		});
	    	
	    		
	    })
	    if($.inArray(el.ARCID, uniqueIds) === -1) uniqueIds.push(el.ARCID);
			});
		console.log(uniqueIds)
		var url = window.location.href
		var hash = url.split('/')[5]
		console.log(hash)
		$.each(uniqueIds, function(i, uniqueId){
			$("#projects").append('<tr id="' + uniqueId + '-row"><td>' + uniqueId + '</td><td><a href="#/' + uniqueId + '" class="btn btn-default btn-xs view" role="button">View</a></td><td><a href="http://documents.atlantaregional.com/factsheets/' + uniqueId + '.PDF" class="btn btn-default btn-xs" role="button">Fact Sheet</a></td></tr>');
			// <td><button id="' + id + '-history" class="history btn btn-default btn-xs" role="button">History</button></td>
			if (uniqueId === hash){
				$('#' + hash + '-row').addClass('active')
				id = uniqueId
			}
		
		
			// $('.view-row').click(function(){
				
			// 	// $(this).siblings().each(function() {
			// 	// 	$('.active').remove()
			// 	// })
			// 	$(this).addClass('active')
			// })
		})
	}
	var urls = [];
	var projects = ""
	// $("#main").append("<div id=\""+data.accounts[i].account.toLowerCase()+"\" class=\"organization\"><h2>"+data.accounts[i].organization+"</h2></div>");
	// $.getJSON("https://api.github.com/repos/landonreed/plan-it/branches?callback=?", function (repo_data) {
 //        for (var j = 0; j < repo_data.data.length; j += 1) {
 //            var appendStr = "<div class=\"branch\">";

 //            // if (repo_data.data[j].language !== null) {
 //            //         appendStr += "<span class=\"language label\">"+repo_data.data[j].language+"</span>";
 //            // }

 //            // appendStr += "<span class=\"forks\"><i class=\"icon-random\"></i> "+repo_data.data[j].forks+"</span>";
 //            // appendStr += "<span class=\"watchers\"><i class=\"icon-eye-open\"></i> "+repo_data.data[j].watchers+"</span>";

 //            appendStr += "<h3><a href=\"https://github.com/landonreed/plan-it/tree/"+repo_data.data[j].name+"\">"+repo_data.data[j].name+"</a></h3>";

 //            // if (repo_data.data[j].description !== null) {
 //            //         appendStr += "<p>"+repo_data.data[j].description+"</p>";
 //            // }

 //            $("#branches").append(appendStr);
 //        }
	// });
var rawUrl = ""
var apiUrl = ""
	$.getJSON("https:// " + "apiWOMPERS" + ".github.com/repos/landonreed/plan-it/tags?callback=?", function (repo_data) {
        for (var j = 0; j < repo_data.data.length; j += 1) {
            var appendStr = "<div class=\"branch\">";

            // if (repo_data.data[j].language !== null) {
            //         appendStr += "<span class=\"language label\">"+repo_data.data[j].language+"</span>";
            // }
            rawUrl = "https://raw.github.com/landonreed/plan-it/"+repo_data.data[j].name+"/data/TIP/projects.csv"
            apiUrl = "https://api.github.com/repos/landonreed/plan-it/contents/"+repo_data.data[j].name+"/data/TIP/projects.csv"
            // appendStr += "<span class=\"forks\"><i class=\"icon-random\"></i> "+repo_data.data[j].forks+"</span>";
            // appendStr += "<span class=\"watchers\"><i class=\"icon-eye-open\"></i> "+repo_data.data[j].watchers+"</span>";
            urls.push(apiUrl)
            appendStr += "<h3><a href=\"https://raw.github.com/landonreed/plan-it/"+repo_data.data[j].name+"/data/TIP/projects.csv\">"+repo_data.data[j].name+"</a></h3>";

            // if (repo_data.data[j].description !== null) {
            //         appendStr += "<p>"+repo_data.data[j].description+"</p>";
            // }
				
			//  Need to put tag name in 'ref' parameter
			// e.g. https://api.github.com/repos/landonreed/plan-it/contents/data/TIP/projects.csv?ref=TIP-09Q3
			// Which yields:
			// {
			//   "name": "projects.csv",
			//   "path": "data/TIP/projects.csv",
			//   "sha": "2a4f6193260c7d85ffdcd9974c13a4a8ad726a22",
			//   "size": 1143628,
			//   "url": "https://api.github.com/repos/landonreed/plan-it/contents/data/TIP/projects.csv?ref=TIP-09Q3",
			//   "html_url": "https://github.com/landonreed/plan-it/blob/TIP-09Q3/data/TIP/projects.csv",
			//   "git_url": "https://api.github.com/repos/landonreed/plan-it/git/blobs/2a4f6193260c7d85ffdcd9974c13a4a8ad726a22",
			//   "type": "file",
			//   "content": "",
			//   "encoding": "base64",
			//   "_links": {
			//     "self": "https://api.github.com/repos/landonreed/plan-it/contents/data/TIP/projects.csv?ref=TIP-09Q3",
			//     "git": "https://api.github.com/repos/landonreed/plan-it/git/blobs/2a4f6193260c7d85ffdcd9974c13a4a8ad726a22",
			//     "html": "https://github.com/landonreed/plan-it/blob/TIP-09Q3/data/TIP/projects.csv"
			//   }
			// }
			// Then use git_url...ugh...maybe we should just store the blob url
			// for n tags
			// first method yields n * 3 calls
			// if we store tag name and blob
			// then we get n calls

   //          console.log(apiUrl)
			// $.get(apiUrl, function(data){
			// 	projects += data
			// 	console.log(data)
			// })
            $("#tags").append(appendStr);
        }
	});
	// $.each(urls, function(i, url){

	// })
	// for (url in urls){
	// 	d3.csv
	// }

</script>