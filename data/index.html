---
layout: viz
title: Data
category: 'data'
---
<script src="{{ site.baseurl}}/lib/javascripts/director.min.js"></script>
<script src="{{ site.baseurl}}/lib/javascripts/json-to-table.js"></script>
<ul id="myTab" class="nav nav-tabs">
  <li class="active"><a href="#proj">Projects</a></li>
  <li><a href="#data">Data</a></li>
  <li><a href="#other">Other</a></li>
</ul>
<div class="tab-content">
	<div id="proj" class="tab-pane active">
	<div id="project" class="col-md-6 col-sm-6 pull-right" style="display:none; z-index:1000;">
   		<h3><span class="arcid"></span><span style="float:right; font-size:small"><button class="btn btn-default" id="edit" role="button">Edit</button></span></h3>
		<p><span class="description"></span></p>
		<p>
			<strong>Sponsor:</strong> <span class="sponsor"></span>&nbsp;&nbsp;&nbsp;
			<strong>Jurisdiction:</strong> <span class="jurisdiction"></span>&nbsp;&nbsp;&nbsp;
			<strong>Status:</strong> <span class="status"></span>
		</p>
		<p>
			<strong>Analysis Level:</strong> <span class="analysis"></span>&nbsp;&nbsp;&nbsp;
		</p>
		<p><strong>FiscalYear:</strong> 
		<span><select class="fiscal-year" >
			  <option>2013</option>
			  <option>2014</option>
			  <option>2015</option>
			  <option>2016</option>
			  <option>2017</option>
			</select>
		</span>
		</p>
		<div id="js-table"></div>
		<hr>
		<h4>Open an issue for <span class="arcid"></span>:</h4>
		<input id="issue-title" type="text" class="form-control" placeholder=""></br>
		<textarea id="issue-body" class="form-control" rows="3" placeholder="Describe issue or change here..."></textarea></br>
		<label>Issue Type:</label></br>
		<button id="general" class="issue btn btn-sm btn-primary" role="button">General</button>
		<button id="delay" class="issue btn btn-sm btn-warning" role="button">Delay</button>
		<button id="delete" class="issue btn btn-sm btn-danger" role="button">Delete</button>
		<button id="funding" class="issue btn btn-sm btn-success" role="button">Funding</button><hr>
		<!-- "https://github.com/landonreed/plan-it/issues/new?title='+el.ARCID+'&body='+$('#issue-body').val()+'" -->
	</div>
	<div class="col-md-6 col-sm-6">
		<h1>Individual Projects</h1>
		<p>Here you'll find all of the data segmented by individual projects:</p>
		<div style="height:300px; overflow:auto;">
			<table id="projects"  class="table table-hover table-condensed"></table>
		</div>
	</div>
	
   </div>
   <div id="other" class="tab-pane">
   	 <div class="col-md-6">
     <h1>Other</h1>
     </div>
   </div>
   <div id="data" class="tab-pane">
		<div class="col-md-6">
			<h1>Data</h1>

			<p>You can find all of the raw data related to transportation projects here:</p>
			<ul>
			<li><a href="https://github.com/landonreed/plan-it/tree/gh-pages/data/TIP">TIP</a></li>
			<li><a href="https://github.com/landonreed/plan-it/tree/gh-pages/data/LR">Long-range plan</a></li>
			</ul>
			
			<!-- <div id="tags">
				<h3>Tags</h3>
			</div> -->
		</div>
	</div>
</div>


<script type="text/javascript">
	$(document).ready(function(){
		var url = window.location.href
		var hash = url.split('/')[5]
		console.log(hash)
		$('#' + hash + '-row').addClass('active')
	})
	$('#myTab a').click(function (e) {
	  e.preventDefault()
	  $(this).tab('show')
	})
	var previous;
	var id;
	var record;
    $("select").focus(function () {
        // Store the current value on focus and on change
        previous = this.value;
    })
	var router = new Router().init();
	$('.fiscal-year').change(function(){
		var value = $('.fiscal-year').val()
		if (value != previous){
			$('#issue-title').attr('placeholder', id + ': change fiscal year from ' + previous + ' to ' + value)
			$('.issue').attr("disabled", true)
			$('#delay').attr('disabled', false)
		}
		else{
			$('#issue-title').attr('placeholder', id)
			$('.issue').attr("disabled", false)
		}

	})
	$('.issue').click(function(){
		var title = ($('#issue-title').val()) ? $('#issue-title').val() : $('#issue-title').attr('placeholder')
		var body = ($('#issue-body').val()) ? $('#issue-body').val() : ''
		window.location='https://github.com/landonreed/plan-it/issues/new?title='+title+'&body='+body+'&labels='+this.id
	})
	$('.view').live('click', function(){
		var color = 'active'
		$(this).closest('tr').addClass(color).siblings().removeClass(color);
	})
	$('#edit').click(function(){
		window.location='https://github.com/landonreed/plan-it/edit/gh-pages/data/TIP/individual/'+ $('.arcid').html() +'.csv'
	})
	href="https://github.com/landonreed/plan-it/edit/gh-pages/data/TIP/individual/'+el.ARCID+'.csv"
	var uniqueIds = [];
	var jsonHtmlTable;
	function doDataThings(error, rows){
		data = rows

		console.log(data);
		$.each(data, function(i, el){
	    router.on('/'+el.ARCID, function () {
	    	d3.csv("{{ site.baseurl}}/data/TIP/individual/"+el.ARCID+".csv")
	    	.row(function(d) {
		    return {
		        // ARCID: d.ARCID,
		        // Description: d.Description,
		        // Jurisdiction: d.Jurisdiction,
		        // ModelingNetworkYear: d.ModelingNetworkYear,
		        // Sponsor: d.Sponsor,
		        // ExistLanes: d.ExistLanes,
		        // ProposedLanes: d.ProposedLanes,
		        // Length: d.Length,
		        // GDOTPI: d.GDOTPI,
		        // Limits: d.Limits,
		        // Status: d.Status,
		        // ProjectType: d.ProjectType,
		        // Analysis: d.Analysis,
		        Phase: d.Phase,
		        PhaseStatus: d.PhaseStatus,
		        FiscalYear: d.FiscalYear,
		        // FundSource: d.FundSource,
		        Federal: d.Federal,
		        State: d.State,
		        Local: d.Local,
		        Bond: d.Bond,
		        Total: d.Total
		        // FederalSum: d.FederalSum,
		        // StateSum: d.StateSum,
		        // LocalSum: d.LocalSum,
		        // BondSum: d.BondSum,
		        // TotalSum: d.TotalSum
		      };
		})
	    	.get(function(error, rows){
	    		record = rows;
	    		jsonHtmlTable = ConvertJsonToTable(record, 'json-table', 'table table-condensed', 'Download');
				console.log(rows)
				$('#project')
		    		.fadeOut(250, function(){
		    			$('#issue-title').attr('placeholder', el.ARCID)
	    				$('.arcid').empty().append(el.ARCID)
	    				$('.sponsor').empty().append(el.Sponsor)
	    				$('.jurisdiction').empty().append(el.Jurisdiction)
	    				$('.status').empty().append(el.Status)
	    				$('.analysis').empty().append(el.Analysis)
	    				$('.description').empty().append(el.Description)
	    				$('.fiscal-year').val(el.FiscalYear)
	    				$('#js-table').html(jsonHtmlTable)
	    				$('#project').fadeIn(250)

	    				id = el.ARCID
    			})
		});
	    	
	    		
	    })
	    if($.inArray(el.ARCID, uniqueIds) === -1) uniqueIds.push(el.ARCID);
			});
		console.log(uniqueIds)
		var url = window.location.href
		var hash = url.split('/')[5]
		console.log(hash)
		$.each(uniqueIds, function(i, id){
			$("#projects").append('<tr id="' + id + '-row"><td>' +id + '</td><td><a href="#/' + id + '" class="btn btn-default btn-xs view" role="button">View</a></td><td><a href="http://documents.atlantaregional.com/factsheets/' + id + '.PDF" class="btn btn-default btn-xs" role="button">Fact Sheet</a></td></tr>');
			if (id === hash){
				$('#' + hash + '-row').addClass('active')

			}
		
		
			// $('.view-row').click(function(){
				
			// 	// $(this).siblings().each(function() {
			// 	// 	$('.active').remove()
			// 	// })
			// 	$(this).addClass('active')
			// })
		})
	}
	var urls = [];
	var projects = ""
	// $("#main").append("<div id=\""+data.accounts[i].account.toLowerCase()+"\" class=\"organization\"><h2>"+data.accounts[i].organization+"</h2></div>");
	// $.getJSON("https://api.github.com/repos/landonreed/plan-it/branches?callback=?", function (repo_data) {
 //        for (var j = 0; j < repo_data.data.length; j += 1) {
 //            var appendStr = "<div class=\"branch\">";

 //            // if (repo_data.data[j].language !== null) {
 //            //         appendStr += "<span class=\"language label\">"+repo_data.data[j].language+"</span>";
 //            // }

 //            // appendStr += "<span class=\"forks\"><i class=\"icon-random\"></i> "+repo_data.data[j].forks+"</span>";
 //            // appendStr += "<span class=\"watchers\"><i class=\"icon-eye-open\"></i> "+repo_data.data[j].watchers+"</span>";

 //            appendStr += "<h3><a href=\"https://github.com/landonreed/plan-it/tree/"+repo_data.data[j].name+"\">"+repo_data.data[j].name+"</a></h3>";

 //            // if (repo_data.data[j].description !== null) {
 //            //         appendStr += "<p>"+repo_data.data[j].description+"</p>";
 //            // }

 //            $("#branches").append(appendStr);
 //        }
	// });
var rawUrl = ""
var apiUrl = ""
	$.getJSON("https:// " + "apiWOMPERS" + ".github.com/repos/landonreed/plan-it/tags?callback=?", function (repo_data) {
        for (var j = 0; j < repo_data.data.length; j += 1) {
            var appendStr = "<div class=\"branch\">";

            // if (repo_data.data[j].language !== null) {
            //         appendStr += "<span class=\"language label\">"+repo_data.data[j].language+"</span>";
            // }
            rawUrl = "https://raw.github.com/landonreed/plan-it/"+repo_data.data[j].name+"/data/TIP/projects.csv"
            apiUrl = "https://api.github.com/repos/landonreed/plan-it/contents/"+repo_data.data[j].name+"/data/TIP/projects.csv"
            // appendStr += "<span class=\"forks\"><i class=\"icon-random\"></i> "+repo_data.data[j].forks+"</span>";
            // appendStr += "<span class=\"watchers\"><i class=\"icon-eye-open\"></i> "+repo_data.data[j].watchers+"</span>";
            urls.push(apiUrl)
            appendStr += "<h3><a href=\"https://raw.github.com/landonreed/plan-it/"+repo_data.data[j].name+"/data/TIP/projects.csv\">"+repo_data.data[j].name+"</a></h3>";

            // if (repo_data.data[j].description !== null) {
            //         appendStr += "<p>"+repo_data.data[j].description+"</p>";
            // }
				
			//  Need to put tag name in 'ref' parameter
			// e.g. https://api.github.com/repos/landonreed/plan-it/contents/data/TIP/projects.csv?ref=TIP-09Q3
			// Which yields:
			// {
			//   "name": "projects.csv",
			//   "path": "data/TIP/projects.csv",
			//   "sha": "2a4f6193260c7d85ffdcd9974c13a4a8ad726a22",
			//   "size": 1143628,
			//   "url": "https://api.github.com/repos/landonreed/plan-it/contents/data/TIP/projects.csv?ref=TIP-09Q3",
			//   "html_url": "https://github.com/landonreed/plan-it/blob/TIP-09Q3/data/TIP/projects.csv",
			//   "git_url": "https://api.github.com/repos/landonreed/plan-it/git/blobs/2a4f6193260c7d85ffdcd9974c13a4a8ad726a22",
			//   "type": "file",
			//   "content": "",
			//   "encoding": "base64",
			//   "_links": {
			//     "self": "https://api.github.com/repos/landonreed/plan-it/contents/data/TIP/projects.csv?ref=TIP-09Q3",
			//     "git": "https://api.github.com/repos/landonreed/plan-it/git/blobs/2a4f6193260c7d85ffdcd9974c13a4a8ad726a22",
			//     "html": "https://github.com/landonreed/plan-it/blob/TIP-09Q3/data/TIP/projects.csv"
			//   }
			// }
			// Then use git_url...ugh...maybe we should just store the blob url
			// for n tags
			// first method yields n * 3 calls
			// if we store tag name and blob
			// then we get n calls

   //          console.log(apiUrl)
			// $.get(apiUrl, function(data){
			// 	projects += data
			// 	console.log(data)
			// })
            $("#tags").append(appendStr);
        }
	});
	// $.each(urls, function(i, url){

	// })
	// for (url in urls){
	// 	d3.csv
	// }

</script>